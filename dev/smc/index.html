<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using SMC · SMC.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SMC.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Using SMC</a><ul class="internal"><li><a class="tocitem" href="#SMC-Main-Function-1"><span>SMC Main Function</span></a></li></ul></li><li><a class="tocitem" href="../helpers/">Helper Functions</a></li><li><a class="tocitem" href="../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Using SMC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using SMC</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FRBNY-DSGE/SMC.jl/blob/master/docs/src/smc.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="SMC-Main-Function-1"><a class="docs-heading-anchor" href="#SMC-Main-Function-1">SMC Main Function</a><a class="docs-heading-anchor-permalink" href="#SMC-Main-Function-1" title="Permalink"></a></h2><p>You can use SMC to estimate any Bayesian model. This requires (1) parameters and their associated prior distributions (2) data (3) a log-likelihood function. These three ingredients are the only inputs into the smc driver.</p><p><code>smc(loglikelihood::Function, parameters::ParameterVector, data::Matrix)</code> function.</p><p>Let&#39;s look at an example. First, we&#39;ll make a model. We need the <a href="https://frbny-dsge.github.io/ModelConstructors.jl">ModelConstructors</a> package to do that.</p><pre><code class="language-julia">using ModelConstructors
ols_model = GenericModel()</code></pre><pre><code class="language-none">Model 
no. parameters:             0
description:
 A generic model: You can put parameters, states, shocks, observables, pseudo-observables, spec, subpsec, settings inside of me.
</code></pre><p>Next, assign our intercept and coefficient parameters to the model.</p><pre><code class="language-">reg &lt;= parameter(:α1, 0., (-1e5, 1e5), (-1e5, 1e5), Untransformed(), Normal(0, 10), fixed = false)
reg &lt;= parameter(:β1, 0., (-1e5, 1e5), (-1e5, 1e5), Untransformed(), Normal(0, 10), fixed = false)</code></pre><p>The first argument is the name of the parameter, the second is its initial value, the third and fourther are bounds on the parameter (they should always be the same). If the sampler draws a value outside of these bounds, it&#39;ll try again. The fifth argument is whether you would like to perform a transformation on the parameter when using it (ignore this for now–it&#39;s for more advanced users). The sixth argument is the prior, <span>$N(0, 10)$</span>, and last argument says the parameters aren&#39;t fixed parameters (i.e. we&#39;re trying to estimate them!)</p><p>We&#39;ll make some artifical data to test our model</p><pre><code class="language-">X = rand(100) #hide
β = 1.
α = 1.
y = β*X + α</code></pre><p>We need a log-likelihood function! Note that it&#39;s important you define a log-likelihood function rather than a likelihood function.</p><pre><code class="language-julia">function likelihood_fnct(p, d)
    α = p[1]
    β = p[2]
    Σ = 1
    det_Σ = det(Σ)
    inv_Σ = inv(Σ)
    term1 = -N / 2 * log(2 * π) - 1 /2 * log(det_Σ)
    logprob = 0.
    errors = d[:, 1] .- α .- β .* d[:, 2]
    for t in 1:size(d,1)
        logprob += term1 - 1/2 * dot(errors, inv_Σ * errors)
    end
    return logprob
end</code></pre><pre><code class="language-none">likelihood_fnct (generic function with 1 method)</code></pre><p>And that&#39;s it! Now let&#39;s run SMC.</p><pre><code class="language-">smc(likelihood_fnct, reg.parameters, data, n_parts = 10, use_fixed_schedule = false, tempering_target = 0.97)</code></pre><article class="docstring"><header><a class="docstring-binding" id="SMC.smc-Union{Tuple{U}, Tuple{S}, Tuple{Function,Array{AbstractParameter{U},1},Array{S,2}}} where U&lt;:Number where S&lt;:AbstractFloat" href="#SMC.smc-Union{Tuple{U}, Tuple{S}, Tuple{Function,Array{AbstractParameter{U},1},Array{S,2}}} where U&lt;:Number where S&lt;:AbstractFloat"><code>SMC.smc</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">function smc(loglikelihood::Function, parameters::ParameterVector{U}, data::Matrix{S};
             kwargs...) where {S&lt;:AbstractFloat, U&lt;:Number}</code></pre><p><strong>Arguments:</strong></p><ul><li><code>loglikelihood::Function</code>: Log-likelihood function of model being estimated. Takes <code>parameters</code>   and <code>data</code> as arguments.</li><li><code>parameters::ParameterVector{U}</code>: Model parameter vector, which stores parameter values,   prior dists, and bounds.</li><li><code>data</code>: A matrix or dataframe containing the time series of the observables used in   the calculation of the posterior/loglikelihood</li><li><code>old_data</code>: A matrix containing the time series of observables of previous data   (with <code>data</code> being the new data) for the purposes of a time tempered estimation   (that is, using the posterior draws from a previous estimation as the initial set   of draws for an estimation with new data)</li></ul><p><strong>Keyword Arguments:</strong></p><ul><li><code>verbose::Symbol</code>: Desired frequency of function progress messages printed to standard out.</li></ul><pre><code class="language-none">- `:none`: No status updates will be reported.
- `:low`: Status updates for SMC initialization and recursion will be included.
- `:high`: Status updates for every iteration of SMC is output, which includes
the mean and standard deviation of each parameter draw after each iteration,
as well as calculated acceptance rate, ESS, and number of times resampled.</code></pre><ul><li><p><code>parallel::Bool</code>: Flag for running algorithm in parallel.</p></li><li><p><code>n_parts::Int</code>: Number of particles.</p></li><li><p><code>n_blocks::Int</code>: Number of parameter blocks in mutation step.</p></li><li><p><code>n_mh_steps::Int</code>: Number of Metropolis Hastings steps to attempt during the mutation step.</p></li><li><p><code>λ::S</code>: The &#39;bending coefficient&#39; λ in Φ(n) = (n/N(Φ))^λ</p></li><li><p><code>n_Φ::Int</code>: Number of stages in the tempering schedule.</p></li><li><p><code>resampling_method::Symbol</code>: Which resampling method to use.</p><ul><li><code>:systematic</code>: Will use sytematic resampling.</li><li><code>:multinomial</code>: Will use multinomial resampling.</li><li><code>:polyalgo</code>: Samples using a polyalgorithm.</li></ul></li><li><p><code>threshold_ratio::S</code>: Threshold s.t. particles will be resampled when the population   drops below threshold * N.</p></li><li><p><code>c::S</code>: Scaling factor for covariance of the particles. Controls size of steps in mutation step.</p></li><li><p><code>α::S</code>: The mixture proportion for the mutation step&#39;s proposal distribution.</p></li><li><p><code>target::S</code>: The initial target acceptance rate for new particles during mutation.</p></li><li><p><code>use_chand_recursion::Bool</code>: Flag for using Chandrasekhar Recursions in Kalman filter.</p></li><li><p><code>use_fixed_schedule::Bool</code>: Flag for whether or not to use a fixed tempering (ϕ) schedule.</p></li><li><p><code>tempering_target::S</code>: Coefficient of the sample size metric to be targeted when solving   for an endogenous ϕ.</p></li><li><p><code>old_data::Matrix{S}</code>: data from vintage of last SMC estimation. Running a bridge   estimation requires <code>old_data</code> and <code>old_cloud</code>.</p></li><li><p><code>old_cloud::Cloud</code>: associated cloud borne of old data in previous SMC estimation.   Running a bridge estimation requires <code>old_data</code> and <code>old_cloud</code>. If no <code>old_cloud</code>   is provided, then we will attempt to load one using <code>loadpath</code>.</p></li><li><p><code>old_vintage::String</code>: String for vintage date of old data</p></li><li><p><code>smc_iteration::Int</code>: The iteration index for the number of times SMC has been run on the    same data vintage. Primarily for numerical accuracy/testing purposes.</p></li><li><p><code>run_test::Bool</code>: Flag for when testing accuracy of program</p></li><li><p><code>filestring_addl::Vector{String}</code>: Additional file string extension for loading old cloud.</p></li><li><p><code>save_intermediate::Bool</code>: Flag for whether one wants to save intermediate Cloud objects</p></li><li><p><code>intermediate_stage_increment::Int</code>: Save Clouds at every increment  (1 = each stage, 10 = every 10th stage, etc.). Useful if you are using a cluster with time   limits because if you hit the time limit, then you can just   start from an intermediate stage rather than start over.</p></li><li><p><code>continue_intermediate::Bool</code>: Flag to indicate whether one is continuing SMC from an   intermediate stage.</p></li><li><p><code>intermediate_stage_start::Int</code>: Intermediate stage at which one wishes to begin the estimation.</p></li><li><p><code>tempered_update_prior_weight::Float64 = 0.0</code>: Weight placed on the current priors of parameters   to construct a convex combination of draws from current priors and the previous estimation&#39;s   cloud. The convex combination serves as the bridge distribution for a time tempered estimation.</p></li><li><p><code>run_csminwel::Bool = true</code>: Flag to run the csminwel algorithm to identify the true posterior mode   (which may not exist) after completing an estimation. The mode identified by SMC is just   the particle with the highest posterior value, but we do not check it is actually a mode (i.e.   the Hessian is negative definite).</p></li><li><p><code>regime_switching::Bool = false</code>: Flag if there are regime-switching parameters. Otherwise, not all the values of the   regimes will be used or saved.</p></li></ul><p><strong>Outputs</strong></p><ul><li><code>cloud</code>: The Cloud object containing all of the information about the   parameter values from the sample, their respective log-likelihoods, the ESS   schedule, tempering schedule etc., which is saved in the saveroot.</li></ul><p><strong>Overview</strong></p><p>Sequential Monte Carlo can be used in lieu of Random Walk Metropolis Hastings to     generate parameter samples from high-dimensional parameter spaces using     sequentially constructed proposal densities to be used in iterative importance     sampling.</p><p>This implementation is based on Edward Herbst and Frank Schorfheide&#39;s 2014 paper     &#39;Sequential Monte Carlo Sampling for DSGE Models&#39; and the code accompanying their     book &#39;Bayesian Estimation of DSGE Models&#39;.</p><p>SMC is broken up into three main steps:</p><ul><li><code>Correction</code>: Reweight the particles from stage n-1 by defining incremental weights,   which gradually &quot;temper in&quot; the loglikelihood function p(Y|θ)^(ϕ<em>n - ϕ</em>n-1) into the   normalized particle weights.</li><li><code>Selection</code>: Resample the particles if the distribution of particles begins to   degenerate, according to a tolerance level for the ESS.</li><li><code>Mutation</code>: Propagate particles {θ(i), W(n)} via N(MH) steps of a Metropolis   Hastings algorithm.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/FRBNY-DSGE/SMC.jl/blob/079eca02656ec3073d0d087bf0d0b38987417713/src/smc_main.jl#L1-L104">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../helpers/">Helper Functions »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 15 July 2020 17:45">Wednesday 15 July 2020</span>. Using Julia version 1.1.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
